# Building shaders

Each host platform needs to build the bgfx tools once, or after each bgfx update.

These tools are used to build the `shaderc` shaders into the various graphics API.

## All platforms

In `common/bgfx/bgfx`, generate project:

```shell
make projgen
```

## On Windows

### Build tools

You only need to do this once:

- if necessary manually create folder(s) common/bgfx/bgfx/tools/bin/windows	
- undo the changes made for the particubes "Font injection patch" in Bgfx-imgui context
	don't forget to redo these changes afer building the tools
	check details about this patch in common/bgfx/README
- on windows, makefiles use MinGW64 compilers
- on windows, some paths may be too long? eg. on a PC it was necessary to rename the following file and its usages:
`conditional_branch_to_simple_conditional_branch_reduction_opportunity.h/cpp` into `conditional_branch_to_simple_conditional_branch_reduc_opportunity.h/cpp`

`export MINGW=/c/MinGW64/mingw64`
`make tools` or simply `make shaderc`
	
### Build shaders

Notes:

- makefile in same directory as the shaders or set:
`export SHADERS_DIR=shader_dir/`
- on windows, use MinGW64 bash as the makefiles autogenerated by genie contain forward slashes

`export OS=windows` other values: darwin, linux
`make rebuild`

## On macOS

### Build tools

```shell
cd common/bgfx/bgfx
mkdir -p tools/bin/darwin
make projgen
make shaderc
```

### Build shaders

```shell
cd common/shaders
# Metal shaders:
OS=darwin make TARGET=5
```

## Shader targets

We currently use dx11, essl, and metal shaders.

0 : dx9
1 : dx11 (Windows)
2 : essl
3 : essl (Android, Web)
4 : glsl 
5 : metal (macOS, iOS)
6 : pssl
7 : spirv 
